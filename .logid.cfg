// Location: /etc/logid.cfg
//
// Run `sudo logid -v` to see the name(s) of connected devices.
//
// After editing, run the following to reload:
// sudo systemctl restart logid
//
// Resources:
// https://github.com/PixlOne/logiops/wiki/Configuration
// https://github.com/torvalds/linux/blob/master/include/uapi/linux/input-event-codes.h

// Keyboard
ignore: [0x00a7]

// Mouse
devices: (
{
	name: "MX Master 3 for Mac";

	// Lower threshold number makes the wheel switch to free-spin mode.
	smartshift:
	{
		on: true;
		threshold: 7;
	};

  // Controls scrolling speed.
	hiresscroll:
	{
    hires: true;
    invert: false;
    target: true;
    up: {
        mode: "Axis";
        axis: "REL_WHEEL_HI_RES";
        axis_multiplier: 4;
    },
    down: {
        mode: "Axis";
        axis: "REL_WHEEL_HI_RES";
        axis_multiplier: -4;
    },
	};

	// Higher numbers make the mouse more sensitive (cursor moves faster),
	// 4000 max for MX Master 3.
	dpi: 1500;

  // Left-side thumbwheel
  thumbwheel:
	{
    // divert: true = handled by logid; divert: false = handled by OS.
    divert: true;

    // Switch directions.
    invert: false;

    // Not reliable in the MX Master 3 for Mac.
    // touch: {
    //    type: "Keypress"
    //    keys: [ "KEY_LEFTMETA", "KEY_TAB" ];
    // };

    // Not reliable in the MX Master 3 for Mac.
    // tap: {
    //     type: "Keypress"
    //     keys: [ "KEY_LEFTMETA", "KEY_TAB" ];
    // };

    // Proximity-touch to scroll wheel.
    // proxy: {
    //   type: "Keypress"
    //   keys: [ "KEY_LEFTMETA", "KEY_TAB" ];
    // };

    // Scroll left.
    left: {
      threshold: 1;
      interval: 1;
      direction: "Left";
      mode: "OnInterval";
      action =
      {
        type: "Keypress";
        keys: [ "KEY_LEFTMETA", "KEY_LEFTSHIFT", "KEY_TAB" ];
      };
    };

    // Scroll right.
    right: {
      threshold: 1;
      interval: 1;
      direction: "Right";
      mode: "OnInterval";
      action =
      {
        type: "Keypress";
        keys: [ "KEY_LEFTMETA", "KEY_TAB" ];
      };
    };
	}

  buttons: (

    // Left-click: 0x50
    // Right-click: 0x51
    // Middle-click? [nonfunctional]: 0x52
    // Back: 0x53
    // Forward: 0x56
    // Thumb: 0xc3
    // Top: 0xc4
    // Thumbwheel-click? [nonfunctional]: 0xd7

    // Left-side top button ("forward")
    {
      cid: 0x56;
      action = {
        type: "Gestures";
        gestures: (
          {
            direction: "None";
            mode: "OnRelease";
            action = {
              type: "Keypress";
              keys: [ "KEY_LEFTMETA", "KEY_PAGEDOWN" ];
            }
          },

          {
            direction: "Up";
            mode: "OnRelease";
            action = {
              type: "Keypress";
              keys: [ "KEY_PLAYPAUSE" ];
            }
          },

          {
            direction: "Down";
            mode: "OnRelease";
            action = {
              type: "Keypress";
              keys: [ "KEY_PLAYPAUSE" ];
            }
          },

          {
            direction: "Right";
            mode: "OnRelease";
            action = {
              type: "Keypress";
              keys: [ "KEY_NEXTSONG" ];
            }
          },

          {
            direction: "Left";
            mode: "OnRelease";
            action = {
              type: "Keypress";
              keys: [ "KEY_PREVIOUSSONG" ];
            }
          }
        );
      };
    },

    // Left-side bottom button ("back")
    {
      cid: 0x53;
      action = {
        type: "Gestures";
        gestures: (
          {
            direction: "None";
            mode: "OnRelease";
            action = {
              type: "Keypress";
              keys: [ "KEY_LEFTMETA", "KEY_PAGEUP" ];
            }
          }
        );
      };
    },

    // Thumb button: Default behavior is LEFTMETA+TAB.
    {
      cid: 0xc3;
      action = {
        type: "Gestures";
        gestures: (
          {
            direction: "None";
            mode: "OnRelease";
            action = {
              type: "Keypress";
			        keys: [ "KEY_LEFTMETA", "KEY_W" ];
            }
          }
        );
      };
    },

    // Top button below scroll wheel
    {
      cid: 0xc4;
      action = {
        type: "Gestures";
        gestures: (
          {
            direction: "None";
            mode: "OnRelease";
            action = {
              type: "ToggleSmartShift";
            }
          },

          {
            direction: "Up";
            mode: "OnRelease";
            action = {
              type: "ChangeDPI";
              inc: 1000,
            }
          },

          {
            direction: "Down";
            mode: "OnRelease";
            action = {
              type: "ChangeDPI";
              inc: -1000,
            }
          }
        );
      };
    }
  );
});